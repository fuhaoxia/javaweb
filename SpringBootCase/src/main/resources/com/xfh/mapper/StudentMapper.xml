<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xfh.mapper.StudentMapper">
    <select id="findStudentByConditions" resultType="com.xfh.domain.Student">
        select s.*,c.name clazzName from student s left join clazz c on s.clazz_id=c.id
        <where>
            <if test="name!=null and name !=''"> s.name=#{name</if>
            <if test="degree!=null"> and s.degree=#{degree}</if>
            <if test="clazzId != null"> and s.clazz_id=#{clazzId}</if>
        </where>

    </select>

    <insert id="addStudent">
        insert student values(null,#{name},#{no},#{gender},#{phone},#{idCard},#{isCollege},#{address},
                              #{degree},#{graduationDate},#{clazzId},#{violationCount},#{violationScore},
                              #{createTime},#{updateTime})
    </insert>

    <select id="findStudentById" resultType="com.xfh.domain.Student">
        select * from student where id=#{id}
    </select>

    <update id="updateStudent">
        update student
        <set>
            name=#{name},no=#{no},gender=#{gender},phone=#{phone},id_card=#{idCard},
            is_college=#{isCollege},address=#{address},graduation_date=#{graduationDate},
            clazz_id=#{clazzId},violation_count=#{violationCount},violation_score=#{violationScore},
            update_time=#{updateTime}
        </set>
        where id=#{id}
    </update>

    <delete id="deleteStudentByIds">
        delete from student where id in
        <foreach collection="ids" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>
    </delete>

    <update id="updateStudentViolation">
        update student
        <set>
            violation_count=violation_count+1,
            violation_score=violation_score+#{score},
        </set>
        where id=#{id}
    </update>

    <select id="getStudentCountData" resultType="java.util.Map">
        select c.name name,count(*) num
        from student s left join clazz  c on s.clazz_id=c.id group by  c.name
    </select>

    <select id="getStudentDegreeData" resultType="java.util.Map">
    select (case when degree=1 then '初中'
                 when degree=2 then '高中'
                 when degree=3 then '大专'
                 when degree=4 then '本科'
                 when degree=5 then '硕士'
                 when degree=6 then '博士' end) name,
        count(*) value
    from student group by degree
    </select>
</mapper>


